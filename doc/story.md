# Story of Bach.java

> Hello.
My name is Christian Stein.
Your build tools are overkill.
Prepare to yet another one.

## Intro

I'll briefly refer to the "as-is" state of build tools
and my motivation to write a lightweight Java build tool for modular Java projects.

### Status Quo

There are many build tools available in the wild.

> Who uses shell scripts, Make, Ant, Maven, ...?

The JDK does not provide a build tool out of the box.

> Why is there no `jbuild`?

The JDK provides foundation tools like `javac`, `jar`, and soon `jpackage`.

> What's a minimal **Java** "build tool"?

- Shuffling the [JDK Foundation Tools] in the right order.
- Passing the right arguments to those calls.
- Based on a modular project model.

> Why didn't build tools embrace Java modules as their basic building blocks of the project models in 2017?

- You program state and logic in a "member".
- You store "members" in a type.
- You organize types in a package.
- You collect packages in a module.
- You bundle modules in an image, or soon in an installer.

> Why even try to [generate](https://www.sitepoint.com/maven-cannot-generate-module-declaration) Java modules?

It feels to me like hoping that a build tool will generate the "right packages" for me as well.
Or even better, also fill those generated packages with the "right types".
Why stop here?
Let build tools also organize and generate members of my types.

> **Conclusion**
If there was a module declaration generator, it still required quite a lot of
configuration to get the resulting file just right. This would not be less work
than just writing the file directly. All together, writing and maintaining the
module declaration yourself gives the guarantee that it will always be as **you**
would expect. [Robert Scholte]

Ha! We're in control.

> Why are there still build tools in 2020 that actively [deny](https://guides.gradle.org/building-java-9-modules) supporting Java modules out of the box?

I guess, we must be glad that `package`s were already introduced in the early days of Java.
Otherwise, the **unnamed package** would be our sole container of all types.

### Enter Bach.java

Ranging from [JDK Foundation Tools], over shell scripts and Apache Ant to multi-language, multi-purpose build tools...

![jdk-and-build-tools-with-bach](img/jdk-and-build-tools-with-bach.svg)

...`Bach.java`'s target is close to platform-specific shell scripts.
For small to mid-size projects, it offers build support in a platform-agnostic manner.

## "Hello World" Demo

Let's start with the simplest possible modular Java project: a single module named `demo`.

The file `module-info.java` only contains `module demo {}`.
It is store in a directory named `src/demo`.
Yes, this demo can't even print "Hello World".
The goal is to create a modular JAR named `demo.jar`.
When that modular JAR is passed to `jar --describe-module --file ${JAR}` the output should read like:
```text
demo jar:file:///.../demo.jar/!module-info.class
requires java.base mandated
```

### Demo "build.bat"

```text
│   build.bat
│
└───src
    └───demo
            module-info.java
```

With `build.bat` reading:
```shell script
javac -d target\classes --module-source-path src --module demo
jar --create --file target\demo.jar -C target\classes\demo .
```

If no error occurs, no output is generated by `javac` and `jar`.
The module description matches the expected one.

### Demo "jshell build.jsh"
```text
│   build.jsh
│
└───src
    └───demo
            module-info.java
```

With `build.jsh` reading:
```shell script
/open https://github.com/sormuras/bach/raw/master/BUILDING
run("javac", "-d", Path.of("target/classes") + "", "--module-source-path", "src", "--module", "demo")
run("jar", "--create", "--file", Path.of("target/demo.jar") + "", "-C", Path.of("target/classes/demo") + "", ".")
/exit
```

Run via `jshell build.jsh` the output reads:
```text
[run] javac with 6 arguments
        -d
          target\classes
        --module-source-path
          src
        --module
          demo

[run] jar with 6 arguments
        --create
        --file
          target\demo.jar
        -C
          target\classes\demo
        .
```
Yeah! A platform-agnostic build script running on all systems that JShell supports.
The module description matches the expected one.

### Demo "jshell https://bit.ly/bach-build"

```text
└───src
    └───demo
            module-info.java
```

Run via `jshell https://bit.ly/bach-build` the _interesting_ output reads:
```text
Project demo 0

Duration Tool
     346 javac -encoding UTF-8 -parameters -Werror -Xlint --class-path  -d .bach\out\realm\classes\jigsaw --module demo --...
     588 javadoc -encoding UTF-8 -locale en -Xdoclint:-missing -d .bach\out\realm\javadoc\jigsaw --module demo -quiet --modu...
     185 jar --create --file .bach\out\realm\deploy\demo-0-javadoc.jar --no-manifest -C .bach\out\realm\javadoc\jigsaw .
      18 jar --create --file .bach\out\realm\modules\demo-0.jar -C .bach\out\realm\classes\jigsaw\demo .
      12 jar --create --file .bach\out\realm\deploy\demo\demo-0-sources.jar --no-manifest -C src\demo .
      89 jdeps --module-path .bach\out\realm\modules;lib --multi-release BASE -summary --dot-output .bach\out\realm\dot --...

1 jar(s) found in: file:///.../.bach/out/realm/modules/
        593 demo-0.jar

Build 1940 took millis.
```

You see, you get a lot more.
Let's have a look at the file tree:

```text
├───.bach
│   └───out
│       │   summary.log
│       │   summary.md
│       │
│       ├───log
│       │       summary-2020-01-02T05-37-06.600098400Z.log
│       │
│       └───realm
│           ├───classes
│           │   └───jigsaw
│           │       └───demo
│           │               module-info.class
│           │
│           ├───deploy
│           │   │   demo-0-javadoc.jar
│           │   │
│           │   └───demo
│           │           demo-0-sources.jar
│           │
│           ├───dot
│           │       demo-0.jar.dot
│           │
│           ├───javadoc
│           │   └───jigsaw
│           │       │   allclasses-index.html   
[...]
│           │
│           └───modules
│                   demo-0.jar
│
├───lib
│       de.sormuras.bach-master-SNAPSHOT.jar
│
└───src
    └───demo
            module-info.java
```

Almost ready to deploy...

### Other Build Tools

How do other build tools cope with such a minimal project?

| Tool           | Project Files | Raw Build Time | Total Time | Tool Files | Tool Size in MB |
|----------------| ------------- | -------------- | ---------- | ---------- | --------------- |
| Bach.java 2.0  |             1 |             2  |         11 |          1 |             0.1 |
| Maven 3.6.3    |             6 |            14  |         18 |       1394 |            44   |
| Gradle 6.0.1   |             7 |            43  |         44 |        447 |           330   |

How many files do you have to create and maintain?
How many files are required to install the tool on your machine?
What's the size of the tool installation? Caches?
Per machine? Per version? Per project?

Find more details in the [comparison](comparison/README.md) of Bach.java, Maven, and Gradle.

## Features

## Model

[JDK Foundation Tools]: https://docs.oracle.com/en/java/javase/11/tools/main-tools-create-and-build-applications.html
